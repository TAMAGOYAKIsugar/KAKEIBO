<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>日別の詳細な収支記録</title>
  <link href="https://fonts.googleapis.com/css2?family=Hina+Mincho&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #fff;
      font-family: 'Hina Mincho', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      color: #8CD790;
      font-size: 2em;
      margin-bottom: 20px;
    }

    #tableContainer {
      overflow-x: auto;
      width: 100%;
      max-width: 1000px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-family: 'Hina Mincho', serif;
    }

    th, td {
      border: 1px solid #5B5B5B;
      padding: 8px 12px;
      font-weight: bold;
    }

    th {
      background-color: #77AF9C;
      color: white;
      text-align: center;
    }

    td {
      background-color: #C5E99B;
      color: #757575;
      text-align: center;
    }

    td.amount {
      text-align: right;
    }

    td.id {
      background-color: #77AF9C;
      color: white;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>日別の詳細な収支記録</h1>

   <div style="margin-bottom: 20px; font-family: 'Hina Mincho', serif;">
      <label for="categoryFilter">カテゴリーで絞り込む：</label>
      <select id="categoryFilter">
        <option value="">すべて表示</option>
      </select>
    </div>

  
  <div id="tableContainer">読み込み中...</div>

  <footer style="margin-top: 40px; text-align: center; font-family: 'Hina Mincho', serif;">
      <p style="color: #8CD790;">他のページへ移動：</p>
      <ul style="list-style: none; padding: 0; font-size: 1em;">
        <li><a href="index.html" style="color: #757575; text-decoration: none;">🏠 ダッシュボードトップ</a></li>
        <li><a href="monthly.html" style="color: #757575; text-decoration: none;">📅 月別カテゴリ集計</a></li>
        <li><a href="yearly.html" style="color: #757575; text-decoration: none;">📈 年間カテゴリ集計</a></li>
      </ul>
  </footer>


  <script>
    let originalRows = [];
    let headers = [];
  
    const headerMap = {
      id: 'ID',
      date: 'DATE',
      amount: '金額',
      memo: 'MEMO',
      category_name: 'カテゴリー'
    };
  
    function renderTable(filteredRows) {
      let html = '<table><tr>';
      headers.forEach(h => {
        const label = headerMap[h] || h;
        html += `<th>${label}</th>`;
      });
      html += '</tr>';
  
      filteredRows.forEach(cells => {
        html += '<tr>';
        cells.forEach((c, index) => {
          const clean = c.replace(/"/g, '').trim();
          const header = headers[index] ? headers[index].toLowerCase() : '';
          let formatted = clean;
          let className = '';
  
          if (header === 'amount') {
            const numeric = clean.replace(/[¥￥,]/g, '');
            const parsed = parseInt(numeric, 10);
            formatted = isNaN(parsed) ? '-' : `${parsed.toLocaleString()}円`;
            className = 'amount';
          } else if (header === 'id') {
            className = 'id';
          }
  
          html += `<td${className ? ` class="${className}"` : ''}>${formatted}</td>`;
        });
        html += '</tr>';
      });
  
      html += '</table>';
      document.getElementById('tableContainer').innerHTML = html;
    }
  
    fetch("daily.csv")
      .then(res => res.text())
      .then(text => {
        const lines = text.trim().split('\n');
        headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
  
        const categorySet = new Set();
  
        for (let i = 1; i < lines.length; i++) {
          if (!lines[i].trim()) continue;
          const cells = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
          if (!cells || cells.length !== headers.length) continue;
  
          originalRows.push(cells);
  
          const categoryIndex = headers.indexOf('category_name');
          if (categoryIndex !== -1) {
            const raw = cells[categoryIndex].replace(/"/g, '').trim();
            if (raw) categorySet.add(raw);
          }
        }
  
        // 🔽 セレクトボックスにカテゴリを追加
        const select = document.getElementById('categoryFilter');
        categorySet.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          select.appendChild(option);
        });
  
        renderTable(originalRows);
      });
  
    // 🔽 セレクトボックスのイベント
    document.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('categoryFilter');
      select.addEventListener('change', function () {
        const selected = this.value;
        const filtered = selected
          ? originalRows.filter(row => row[headers.indexOf('category_name')].includes(selected))
          : originalRows;
        renderTable(filtered);
      });
    });
  </script>

</body>
</html>








